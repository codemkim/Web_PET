{% extends 'header.html' %}
{% load static %}

{% block content %}

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <link rel="stylesheet" href="{% static 'base.css' %}">
    <link rel="" href="{% static 'upload.svg' %}">
    <body>
    <nav class="p-3 container navbar navbar-expand-lg navbar-light" id="main">
        <a class="navbar-brand scroll" style="position: fixed;" href="#main">TIME MaCHiNE</a>
        <a class="navbar-brand scroll" style="visibility: hidden;;" href="#main">TIME MaCHiNE</a>
        <button
                class="navbar-toggler"
                type="button"
                data-toggle="collapse"
                data-target="#navbarNav"
                aria-controls="navbarNav"
                aria-expanded="false"
                aria-label="Toggle navigation"
        >
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item active">
                    <a class="nav-link scroll" href="#test">Go !
                        <span class="sr-only">(current)</span>
                    </a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link scroll" href="#galleries">Galleries</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-toggle="modal" data-target="#loginModal">Team</a>
                </li>

            </ul>
        </div>
    </nav>

    <section class="section">
        <h1 class="title">TIME M<span style="color:#A47D5E;">a</span>CH<span style="color:#A47D5E;">i</span>NE</h1>
        <h2 class="subtitle">볼 수 없어 그리운, 보고싶은 사람과<br/>만나볼 수 있는 기회!</h2>
    </section>
    <script
            class="jsbin"
            src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"
    ></script>
    <div class="mt-2 container file-upload" style="padding-top: 30px; margin-top:100px;" id="test">
        <div class="d-flex justify-content-center" style="padding-bottom: 20px;">
            <h3 class="d-flex align-items-center pr-3">미소</h3>
            <div>
                <input type="checkbox" id="gender">
                <label for="gender">
                <span class="knob">
                    <i></i>
                </span>
                </label>
            </div>
            <h3 class="d-flex align-items-center pl-3">고생했어</h3>
        </div>
        <div class="image-upload-wrap">
            <form method="POST" id="ajax" enctype="multipart/form-data">
                {% csrf_token %}

                <input
                        class="file-upload-input"
                        type="file"
                        onchange="readURL(this);"
                        accept="image/*"
                        name="img"


                />
                <div class="drag-text">
                    <img src="../../static/image/upload.svg" class="mt-5 pt-5"/>
                    <h3 class="mb-5 pb-5 pt-4 upload-text">
                        얼굴 사진을 올려놓거나<br/>
                        눌러서 업로드하세요!
                    </h3>
                </div>
            </form>
        </div>
        <div class="file-upload-content">
            <img class="file-upload-image" id="face-image" src="#" style="width: 350px; height: 300px;"
                 alt="your image"/>
            <div id="loading" class="animated bounce">
                <div class="spinner-border" role="status">
                    <span class="sr-only">Loading...</span>
                </div>
                <h4 class="text-center">AI가 시간 여행을 시도중입니다.</h4>
            </div>
            <div id="insert_video" style="display: flex; justify-content: center;"></div>

            <p class="result-message"></p>
            <div id="label-container" class="d-flex flex-column justify-content-around"></div>
            <div id="addThis" class="addthis_inline_share_toolbox_6lz1"></div>
            <div class="pt-3 image-title-wrap">
                <button
                        type="button p-2"
                        class="try-again-btn"
                        onclick="window.location.reload();"
                >
                    <span class="try-again-text">다른 사진으로 재시도</span>
                </button>
            </div>
        </div>

    </div>

    {#        갤리러 모달 #}
    <div class="gallery-wrap" id="galleries">
        <div class="row justify-content-center">
            <button class="btn btn-lg video" data-video="../../static/video/01.mp4"
                    data-toggle="modal" data-target="#videoModal">
                <img src="../../static/image/01.jpg" style="width: 350px; height: 400px;" class="img-fluid rounded">
            </button>
            <button class="btn btn-lg video" data-video="../../static/video/02.mp4"
                    data-toggle="modal" data-target="#videoModal">
                <img src="../../static/image/02.png" style="width: 350px; height: 400px;" class="img-fluid rounded">
            </button>
            <button class="btn btn-lg video" data-video="../../static/video/03.mp4"
                    data-toggle="modal" data-target="#videoModal">
                <img src="../../static/image/03.jpg" style="width: 350px; height: 400px;" class="img-fluid rounded">
            </button>

        </div>


        <div class="modal fade" id="videoModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
             aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-body">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>

                        <video controls width="100%">
                            <source src="" type="video/mp4">
                        </video>
                    </div>
                </div>
            </div>
        </div>
    </div>


    {#    도움말 모달#}
    <div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="logInModalLabel"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title" id="loginModalLabel"><i class="fas fa-sign-in-alt"></i>&nbsp 참새에 방앗GAN</h1>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="font-size: 2rem;">
                    AI를 활용한 웹 서비스 프로젝트<br>· 곽수연(팀장) : 모델링<br>· 곽희원 : 모델링
                    <br>· 정현경 : 웹 개발<br>· 김현우 : 웹 개발
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer pt-5 container d-flex justify-content-center mt-5">
        <div>
            <p>&copy; 참새에 방앗GAN 2021. All Rights Reserved.</p>
        </div>
    </footer>


    {#    비디오 모달#}
    <script>
        $(function () {
            $(".video").click(function () {
                var theModal = $(this).data("target"),
                    videoSRC = $(this).attr("data-video"),
                    videoSRCauto = videoSRC + "";
                $(theModal + ' source').attr('src', videoSRCauto);
                $(theModal + ' video').load();
                $(theModal + ' button.close').click(function () {
                    $(theModal + ' source').attr('src', videoSRC);
                });
            });
        });
    </script>

    {#    스크롤 자연스럽게 #}
    <script>
        jQuery(document).ready(function ($) {
            {#$('.result_video').hide();#}
            $('.scroll').click(function (event) {
                event.preventDefault();
                $('html,body').animate({scrollTop: $(this.hash).offset().top}, 500);
            });
        });

    </script>

    {#    이미지 업로드#}
    <script>

        function readURL(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {

                    $('.image-upload-wrap').hide();
                    $('#loading').show();
                    $('.file-upload-image').attr('src', e.target.result);
                    $('.file-upload-content').show();
                    $('.image-title').html(input.files[0].name);

                    e.preventDefault();

                    var data = new FormData($('#ajax').get(0));

                    if (document.getElementById('gender').checked) {
                        $.ajax({

                            url: '/make_ani_1/',
                            type: 'POST',
                            data: data,
                            contentType: 'multipart/form-data',
                            processData: false,
                            contentType: false,
                        });
                    } else {
                        $.ajax({
                            url: '/make_ani_2/',
                            type: 'POST',
                            data: data,
                            contentType: 'multipart/form-data',
                            processData: false,
                            contentType: false,

                        });
                    }
                    ;
                };

                reader.readAsDataURL(input.files[0]);

                setTimeout(function () {
                    var 템플릿 = '<video width="700px" height="450px"  src="../../static/result/generated_result.mp4" class="result_video"  controls></video>'
                    $("#insert_video").html(템플릿);
                    {#$('.result_video').show();#}
                    $('.image-upload-wrap').hide();
                    $('#loading').hide();
                    $('.file-upload-image').hide();
                    {#$('.file-upload-content').hide();#}
                }, 10000);
            }

        }
    </script>
    <script type="text/javascript">
        // <![CDATA[
        var colour = "random"; // in addition to "random" can be set to any valid colour eg "#f0f" or "red"
        var sparkles = 50;

        /****************************
         *  Tinkerbell Magic Sparkle *
         *(c)2005-13 mf2fm web-design*
         *  http://www.mf2fm.com/rv  *
         * DON'T EDIT BELOW THIS BOX *
         ****************************/
        var x = ox = 400;
        var y = oy = 300;
        var swide = 800;
        var shigh = 600;
        var sleft = sdown = 0;
        var tiny = new Array();
        var star = new Array();
        var starv = new Array();
        var starx = new Array();
        var stary = new Array();
        var tinyx = new Array();
        var tinyy = new Array();
        var tinyv = new Array();

        window.onload = function () {
            if (document.getElementById) {
                var i, rats, rlef, rdow;
                for (var i = 0; i < sparkles; i++) {
                    var rats = createDiv(3, 3);
                    rats.style.visibility = "hidden";
                    rats.style.zIndex = "999";
                    document.body.appendChild(tiny[i] = rats);
                    starv[i] = 0;
                    tinyv[i] = 0;
                    var rats = createDiv(5, 5);
                    rats.style.backgroundColor = "transparent";
                    rats.style.visibility = "hidden";
                    rats.style.zIndex = "999";
                    var rlef = createDiv(1, 5);
                    var rdow = createDiv(5, 1);
                    rats.appendChild(rlef);
                    rats.appendChild(rdow);
                    rlef.style.top = "2px";
                    rlef.style.left = "0px";
                    rdow.style.top = "0px";
                    rdow.style.left = "2px";
                    document.body.appendChild(star[i] = rats);
                }
                set_width();
                sparkle();
            }
        }

        function sparkle() {
            var c;
            if (Math.abs(x - ox) > 1 || Math.abs(y - oy) > 1) {
                ox = x;
                oy = y;
                for (c = 0; c < sparkles; c++) if (!starv[c]) {
                    star[c].style.left = (starx[c] = x) + "px";
                    star[c].style.top = (stary[c] = y + 1) + "px";
                    star[c].style.clip = "rect(0px, 5px, 5px, 0px)";
                    star[c].childNodes[0].style.backgroundColor = star[c].childNodes[1].style.backgroundColor = (colour == "random") ? newColour() : colour;
                    star[c].style.visibility = "visible";
                    starv[c] = 50;
                    break;
                }
            }
            for (c = 0; c < sparkles; c++) {
                if (starv[c]) update_star(c);
                if (tinyv[c]) update_tiny(c);
            }
            setTimeout("sparkle()", 40);
        }

        function update_star(i) {
            if (--starv[i] == 25) star[i].style.clip = "rect(1px, 4px, 4px, 1px)";
            if (starv[i]) {
                stary[i] += 1 + Math.random() * 3;
                starx[i] += (i % 5 - 2) / 5;
                if (stary[i] < shigh + sdown) {
                    star[i].style.top = stary[i] + "px";
                    star[i].style.left = starx[i] + "px";
                } else {
                    star[i].style.visibility = "hidden";
                    starv[i] = 0;
                    return;
                }
            } else {
                tinyv[i] = 50;
                tiny[i].style.top = (tinyy[i] = stary[i]) + "px";
                tiny[i].style.left = (tinyx[i] = starx[i]) + "px";
                tiny[i].style.width = "2px";
                tiny[i].style.height = "2px";
                tiny[i].style.backgroundColor = star[i].childNodes[0].style.backgroundColor;
                star[i].style.visibility = "hidden";
                tiny[i].style.visibility = "visible"
            }
        }

        function update_tiny(i) {
            if (--tinyv[i] == 25) {
                tiny[i].style.width = "1px";
                tiny[i].style.height = "1px";
            }
            if (tinyv[i]) {
                tinyy[i] += 1 + Math.random() * 3;
                tinyx[i] += (i % 5 - 2) / 5;
                if (tinyy[i] < shigh + sdown) {
                    tiny[i].style.top = tinyy[i] + "px";
                    tiny[i].style.left = tinyx[i] + "px";
                } else {
                    tiny[i].style.visibility = "hidden";
                    tinyv[i] = 0;
                    return;
                }
            } else tiny[i].style.visibility = "hidden";
        }

        document.onmousemove = mouse;

        function mouse(e) {
            if (e) {
                y = e.pageY;
                x = e.pageX;
            } else {
                set_scroll();
                y = event.y + sdown;
                x = event.x + sleft;
            }
        }

        window.onscroll = set_scroll;

        function set_scroll() {
            if (typeof (self.pageYOffset) == 'number') {
                sdown = self.pageYOffset;
                sleft = self.pageXOffset;
            } else if (document.body && (document.body.scrollTop || document.body.scrollLeft)) {
                sdown = document.body.scrollTop;
                sleft = document.body.scrollLeft;
            } else if (document.documentElement && (document.documentElement.scrollTop || document.documentElement.scrollLeft)) {
                sleft = document.documentElement.scrollLeft;
                sdown = document.documentElement.scrollTop;
            } else {
                sdown = 0;
                sleft = 0;
            }
        }

        window.onresize = set_width;

        function set_width() {
            var sw_min = 999999;
            var sh_min = 999999;
            if (document.documentElement && document.documentElement.clientWidth) {
                if (document.documentElement.clientWidth > 0) sw_min = document.documentElement.clientWidth;
                if (document.documentElement.clientHeight > 0) sh_min = document.documentElement.clientHeight;
            }
            if (typeof (self.innerWidth) == 'number' && self.innerWidth) {
                if (self.innerWidth > 0 && self.innerWidth < sw_min) sw_min = self.innerWidth;
                if (self.innerHeight > 0 && self.innerHeight < sh_min) sh_min = self.innerHeight;
            }
            if (document.body.clientWidth) {
                if (document.body.clientWidth > 0 && document.body.clientWidth < sw_min) sw_min = document.body.clientWidth;
                if (document.body.clientHeight > 0 && document.body.clientHeight < sh_min) sh_min = document.body.clientHeight;
            }
            if (sw_min == 999999 || sh_min == 999999) {
                sw_min = 800;
                sh_min = 600;
            }
            swide = sw_min;
            shigh = sh_min;
        }

        function createDiv(height, width) {
            var div = document.createElement("div");
            div.style.position = "absolute";
            div.style.height = height + "px";
            div.style.width = width + "px";
            div.style.overflow = "hidden";
            return (div);
        }

        function newColour() {
            var c = new Array();
            ``
            c[0] = 255;
            c[1] = Math.floor(Math.random() * 256);
            c[2] = Math.floor(Math.random() * (256 - c[1] / 2));
            c.sort(function () {
                return (0.5 - Math.random());
            });
            return ("rgb(" + c[0] + ", " + c[1] + ", " + c[2] + ")");
        }

        // ]]>

    </script>


    </body>


{% endblock content %}